(()=>{"use strict";var t={999:(t,e,n)=>{n.d(e,{Z:()=>o});var a=n(81),r=n.n(a),s=n(645),i=n.n(s)()(r());i.push([t.id,'.button{font:500 12px/1.5 "DM Sans",sans-serif;text-transform:uppercase;padding:4px 10px;border:none;border-radius:4px;cursor:pointer;background:#7dd3fc;color:#334155;transition:background .2s ease-in-out,color .2s ease-in-out}.button:disabled{opacity:.5;cursor:default}.button--main{background:#7dd3fc;color:#334155}.button--main:hover{background:#bae6fd}.button--main:disabled{background:#7dd3fc}.button--minor{background:#cbd5e1;color:#334155}.button--minor:hover{background:#e2e8f0}.button--minor:disabled{background:#cbd5e1}.button--selected{background:#7dd3fc;font-weight:600}.button--selected:hover{background:#7dd3fc}.button--drive{width:24px;height:24px;font-size:14px;padding:0;background:#1e293b;color:#16a34a;border:1px solid #16a34a}.button--drive:hover{background:#16a34a;color:#f1f5f9}.button--drive:disabled{background:#1e293b;color:#16a34a}.button--stop{width:24px;height:24px;font-size:14px;padding:0;background:#1e293b;color:#dc2626;border:1px solid #dc2626}.button--stop:hover{background:#dc2626;color:#f1f5f9}.button--stop:disabled{background:#1e293b;color:#dc2626}',""]);const o=i},6:(t,e,n)=>{n.d(e,{Z:()=>o});var a=n(81),r=n.n(a),s=n(645),i=n.n(s)()(r());i.push([t.id,'.form{display:flex;align-items:center;justify-content:space-between;gap:8px}.form__input{height:26px;border-radius:4px;border:none;outline:none;font:400 14px/1.5 "DM Sans",sans-serif;color:#f1f5f9;padding:0 8px;background:#1e293b}.form__input--name{width:90%}.form__input--color{width:10%;padding:0}.form__input:disabled{opacity:.5}',""]);const o=i},756:(t,e,n)=>{n.d(e,{Z:()=>o});var a=n(81),r=n.n(a),s=n(645),i=n.n(s)()(r());i.push([t.id,".pagination{order:3;margin-bottom:20px;display:flex;align-items:center}.pagination__title{margin-right:12px;min-width:88px}.pagination__buttons{display:flex;gap:12px}",""]);const o=i},889:(t,e,n)=>{n.d(e,{Z:()=>o});var a=n(81),r=n.n(a),s=n(645),i=n.n(s)()(r());i.push([t.id,'.car{display:flex;flex-direction:column;gap:16px}.car__header{display:flex;gap:12px}.car__title{display:flex;gap:4px;overflow:hidden}.car__title span:nth-child(2){font-size:10px;font-style:italic;color:#e2e8f0;padding-right:5px}@media(max-width: 768px){.car__title{max-width:245px}}.car__road{border-bottom:1px dashed #1e293b;display:flex;gap:12px;height:32px;position:relative}@keyframes illumination{0%{filter:drop-shadow(1px 1px 4px #f1f5f9)}50%{filter:drop-shadow(1px 1px 4px #64748b)}100%{filter:drop-shadow(1px 1px 4px #1e293b)}}.car__road__message{display:none;position:absolute;left:50%;transform:translateX(-50%);color:#7dd3fc;filter:drop-shadow(1px 1px 4px #f1f5f9);text-transform:uppercase;animation:illumination .5s infinite;max-width:calc(100vw - 200px);text-align:center}.car__road__message.display{display:block}@media(max-width: 768px){.car__road__message{max-width:260px;overflow:hidden}}.car__road__buttons{display:flex;gap:12px}.car__road__finish{margin-left:auto;margin-right:56px;font-size:10px;writing-mode:vertical-rl}.car__icon{width:48px;height:auto;display:flex;align-items:end}.car__icon svg{margin-bottom:4px;filter:drop-shadow(1px 1px 4px #1e293b)}.car__icon--broken{position:relative}.car__icon--broken::after{content:"Uh-oh noooo!";position:absolute;top:-12px;left:50%;transform:translateX(-50%);font-size:10px;white-space:nowrap}@keyframes broke{100%{transform:translateX(-6px)}50%{transform:translateX(-5px)}0%{transform:translateX(-6px)}}.car__icon--broken svg{animation:broke .1s linear infinite}.car__icon--finished{position:relative}.car__icon--finished::after{content:"Yay! I finished";position:absolute;top:-16px;left:50%;transform:translateX(-50%);font-size:10px;white-space:nowrap}.car__icon--winner{position:relative}.car__icon--winner::after{content:"Yes! Yes! Yes!";position:absolute;top:-16px;left:50%;transform:translateX(-50%);font-size:10px;white-space:nowrap}',""]);const o=i},274:(t,e,n)=>{n.d(e,{Z:()=>o});var a=n(81),r=n.n(a),s=n(645),i=n.n(s)()(r());i.push([t.id,".garage{padding:0 24px}.garage__controls{display:flex;flex-direction:column;max-width:400px;gap:12px;margin-bottom:32px;order:1}.garage__buttons{display:flex;align-items:center;gap:12px}.garage__items{display:flex;flex-direction:column;gap:16px;margin:12px 0 24px;order:4}.garage.hidden{display:none}",""]);const o=i},717:(t,e,n)=>{n.d(e,{Z:()=>o});var a=n(81),r=n.n(a),s=n(645),i=n.n(s)()(r());i.push([t.id,".header{display:flex;align-items:center;gap:16px;padding:40px 24px}",""]);const o=i},736:(t,e,n)=>{n.d(e,{Z:()=>o});var a=n(81),r=n.n(a),s=n(645),i=n.n(s)()(r());i.push([t.id,".section{display:flex;flex-direction:column;margin-bottom:40px}.section__title{font-weight:500;font-size:20px;margin-bottom:20px;order:2}",""]);const o=i},997:(t,e,n)=>{n.d(e,{Z:()=>o});var a=n(81),r=n.n(a),s=n(645),i=n.n(s)()(r());i.push([t.id,'.winners{padding:0 24px}.winners__table{width:min(500px,100%);font-size:14px;margin:12px 0 24px;order:4}@media(max-width: 768px){.winners__table{font-size:12px}}.winners__table__row{text-align:left}.winners__table__row th,.winners__table__row td{padding:8px 16px 8px 0}.winners__table__row th:last-child,.winners__table__row td:last-child{padding-right:0}.winners__table__row--name{display:flex;max-width:420px;overflow:hidden;white-space:nowrap}@media(max-width: 768px){.winners__table__row--name{width:140px}}.winners__table__row--name span:nth-child(2){font-size:10px;font-style:italic;margin-left:4px}.winners__table__number{min-width:70px}.winners__table__car{min-width:50px}.winners__table__name{width:auto}.winners__table__wins{min-width:70px}.winners__table__time{min-width:120px}.winners__table__wins,.winners__table__time{cursor:pointer}.winners__table__wins.sort--desc::after,.winners__table__time.sort--desc::after{content:"↓";margin-left:4px}.winners__table__wins.sort--asc::after,.winners__table__time.sort--asc::after{content:"↑";margin-left:4px}.winners.hidden{display:none}',""]);const o=i},99:(t,e,n)=>{n.d(e,{Z:()=>o});var a=n(81),r=n.n(a),s=n(645),i=n.n(s)()(r());i.push([t.id,"@import url(https://fonts.googleapis.com/css2?family=DM+Sans:wght@400;500&display=swap);"]),i.push([t.id,'*{margin:0;padding:0;box-sizing:border-box}body{font:400 16px/1.5 "DM Sans",sans-serif;background:linear-gradient(90deg, #475569, #334155);color:#f1f5f9}',""]);const o=i},645:t=>{t.exports=function(t){var e=[];return e.toString=function(){return this.map((function(e){var n="",a=void 0!==e[5];return e[4]&&(n+="@supports (".concat(e[4],") {")),e[2]&&(n+="@media ".concat(e[2]," {")),a&&(n+="@layer".concat(e[5].length>0?" ".concat(e[5]):""," {")),n+=t(e),a&&(n+="}"),e[2]&&(n+="}"),e[4]&&(n+="}"),n})).join("")},e.i=function(t,n,a,r,s){"string"==typeof t&&(t=[[null,t,void 0]]);var i={};if(a)for(var o=0;o<this.length;o++){var c=this[o][0];null!=c&&(i[c]=!0)}for(var d=0;d<t.length;d++){var l=[].concat(t[d]);a&&i[l[0]]||(void 0!==s&&(void 0===l[5]||(l[1]="@layer".concat(l[5].length>0?" ".concat(l[5]):""," {").concat(l[1],"}")),l[5]=s),n&&(l[2]?(l[1]="@media ".concat(l[2]," {").concat(l[1],"}"),l[2]=n):l[2]=n),r&&(l[4]?(l[1]="@supports (".concat(l[4],") {").concat(l[1],"}"),l[4]=r):l[4]="".concat(r)),e.push(l))}},e}},81:t=>{t.exports=function(t){return t[1]}},379:t=>{var e=[];function n(t){for(var n=-1,a=0;a<e.length;a++)if(e[a].identifier===t){n=a;break}return n}function a(t,a){for(var s={},i=[],o=0;o<t.length;o++){var c=t[o],d=a.base?c[0]+a.base:c[0],l=s[d]||0,p="".concat(d," ").concat(l);s[d]=l+1;var u=n(p),m={css:c[1],media:c[2],sourceMap:c[3],supports:c[4],layer:c[5]};if(-1!==u)e[u].references++,e[u].updater(m);else{var h=r(m,a);a.byIndex=o,e.splice(o,0,{identifier:p,updater:h,references:1})}i.push(p)}return i}function r(t,e){var n=e.domAPI(e);return n.update(t),function(e){if(e){if(e.css===t.css&&e.media===t.media&&e.sourceMap===t.sourceMap&&e.supports===t.supports&&e.layer===t.layer)return;n.update(t=e)}else n.remove()}}t.exports=function(t,r){var s=a(t=t||[],r=r||{});return function(t){t=t||[];for(var i=0;i<s.length;i++){var o=n(s[i]);e[o].references--}for(var c=a(t,r),d=0;d<s.length;d++){var l=n(s[d]);0===e[l].references&&(e[l].updater(),e.splice(l,1))}s=c}}},569:t=>{var e={};t.exports=function(t,n){var a=function(t){if(void 0===e[t]){var n=document.querySelector(t);if(window.HTMLIFrameElement&&n instanceof window.HTMLIFrameElement)try{n=n.contentDocument.head}catch(t){n=null}e[t]=n}return e[t]}(t);if(!a)throw new Error("Couldn't find a style target. This probably means that the value for the 'insert' parameter is invalid.");a.appendChild(n)}},216:t=>{t.exports=function(t){var e=document.createElement("style");return t.setAttributes(e,t.attributes),t.insert(e,t.options),e}},565:(t,e,n)=>{t.exports=function(t){var e=n.nc;e&&t.setAttribute("nonce",e)}},795:t=>{t.exports=function(t){if("undefined"==typeof document)return{update:function(){},remove:function(){}};var e=t.insertStyleElement(t);return{update:function(n){!function(t,e,n){var a="";n.supports&&(a+="@supports (".concat(n.supports,") {")),n.media&&(a+="@media ".concat(n.media," {"));var r=void 0!==n.layer;r&&(a+="@layer".concat(n.layer.length>0?" ".concat(n.layer):""," {")),a+=n.css,r&&(a+="}"),n.media&&(a+="}"),n.supports&&(a+="}");var s=n.sourceMap;s&&"undefined"!=typeof btoa&&(a+="\n/*# sourceMappingURL=data:application/json;base64,".concat(btoa(unescape(encodeURIComponent(JSON.stringify(s))))," */")),e.styleTagTransform(a,t,e.options)}(e,t,n)},remove:function(){!function(t){if(null===t.parentNode)return!1;t.parentNode.removeChild(t)}(e)}}}},589:t=>{t.exports=function(t,e){if(e.styleSheet)e.styleSheet.cssText=t;else{for(;e.firstChild;)e.removeChild(e.firstChild);e.appendChild(document.createTextNode(t))}}}},e={};function n(a){var r=e[a];if(void 0!==r)return r.exports;var s=e[a]={id:a,exports:{}};return t[a](s,s.exports,n),s.exports}n.n=t=>{var e=t&&t.__esModule?()=>t.default:()=>t;return n.d(e,{a:e}),e},n.d=(t,e)=>{for(var a in e)n.o(e,a)&&!n.o(t,a)&&Object.defineProperty(t,a,{enumerable:!0,get:e[a]})},n.o=(t,e)=>Object.prototype.hasOwnProperty.call(t,e),n.nc=void 0,(()=>{function t(t,e){const n=[];let a=e;return{getState:()=>a,subscribe(t){n.push(t),t(a)},dispatch(e){a=t(a,e),n.forEach((t=>t(a)))}}}const e=t(((t,e)=>{const n=JSON.parse(JSON.stringify(t));return"SET_CURRENT_VIEW"===e.type?(n.currentView=e.payload,n):n}),{currentView:"garage"}),a=t=>{e.dispatch({type:"SET_CURRENT_VIEW",payload:t})},r=t(((t,e)=>{const n=JSON.parse(JSON.stringify(t));switch(e.type){case"FETCH":return e.payload&&(n.items=e.payload),e.count&&(n.count=e.count),n;case"FETCH_ERROR":return e.error&&(n.fetchError=e.error),n;case"ADD_ITEMS":return e.payload&&(e.payload.forEach((t=>{n.items.length<7&&n.items.push(t)})),n.count+=e.payload.length),n;case"REMOVE_ITEM":return n.items=n.items.filter((t=>t.id!==e.payload?.[0].id)),n.count-=1,n;case"SELECT_CAR":if(n.isUpdate=!0,e.payload){const a=e.payload?.[0].id,r=t.items.find((t=>t.id===a));r&&(n.selectedCar=r)}return n;case"RESET_UPDATE_CAR":return n.isUpdate=!1,n.selectedCar=null,n;case"UPDATE_ITEM":return n.items.forEach(((t,a)=>{if(t.id===e.payload?.[0].id){const t=e.payload[0];n.items[a]=t}})),n.isUpdate=!1,n.selectedCar=null,n;case"NEXT_PAGE":return(n.count>7||n.page<Math.ceil(n.count/7))&&(n.page+=1),n.isRace=!1,n.currentRaceWinner=null,n;case"PREV_PAGE":return n.page>1&&(n.page-=1),n.isRace=!1,n.currentRaceWinner=null,n;case"ON_RACE_MODE":return n.isRace=!0,n;case"BLOCK_PAGI_AND_NAV":return n.isWalkBlocking=!0,n;case"OFF_RACE_MODE":return n.isRace=!1,n.isWalkBlocking=!1,n;case"ADD_CURRENT_WINNER":return e.winnerId&&(n.currentRaceWinner=e.winnerId),n.isWalkBlocking=!1,n;case"REMOVE_CURRENT_WINNER":return n.currentRaceWinner=null,n;default:return n}}),{items:[],selectedCar:null,isUpdate:!1,isRace:!1,isWalkBlocking:!1,count:0,page:1,currentRaceWinner:null,fetchError:""}),s=r;var i=n(379),o=n.n(i),c=n(795),d=n.n(c),l=n(569),p=n.n(l),u=n(565),m=n.n(u),h=n(216),_=n.n(h),g=n(589),f=n.n(g),w=n(999),b={};b.styleTagTransform=f(),b.setAttributes=m(),b.insert=p().bind(null,"head"),b.domAPI=d(),b.insertStyleElement=_(),o()(w.Z,b),w.Z&&w.Z.locals&&w.Z.locals;const y=({text:t,customClass:e,disabled:n,onClick:a})=>{const r=document.createElement("button");return r.textContent=t,r.classList.add("button"),e&&r.classList.add(e),n&&(r.disabled=!0),a&&r.addEventListener("click",a),r};var E=n(717),x={};x.styleTagTransform=f(),x.setAttributes=m(),x.insert=p().bind(null,"head"),x.domAPI=d(),x.insertStyleElement=_(),o()(E.Z,x),E.Z&&E.Z.locals&&E.Z.locals;var C;!function(t){t.garage="garage",t.winners="winners",t.engine="engine"}(C||(C={}));const v="http://localhost:3000",T={garage:`${v}/${C.garage}`,winners:`${v}/${C.winners}`,engine:`${v}/${C.engine}`},S=async t=>{try{const e=await fetch(T.garage,{method:"POST",body:JSON.stringify(t),headers:{"Content-Type":"application/json"}});return await e.json()}catch(t){throw new Error("Something went wrong")}},R=async()=>{try{const{page:t}=s.getState(),{data:e,count:n}=await(async t=>{try{const e=await fetch(`${T.garage}?_page=${t}&_limit=7`),n=await e.json(),a=e.headers.get("X-Total-Count");return{data:n,count:Number(a)}}catch(t){throw new Error("Something went wrong. Most likely, you need to run the server locally from this repo: https://github.com/mikhama/async-race-api")}})(t);s.dispatch({type:"FETCH",payload:e,count:n})}catch(t){s.dispatch({type:"FETCH_ERROR",error:t})}},A=t(((t,e)=>{const n=JSON.parse(JSON.stringify(t));switch(e.type){case"FETCH":return e.payload&&(n.items=e.payload),e.count&&(n.count=e.count),n;case"FETCH_ERROR":return e.error&&(n.fetchError=e.error),n;case"ADD_WINNER":return e.payload&&n.items.length<10&&n.items.push(e.payload[0]),n.count+=1,n;case"REMOVE_WINNER":return n.items=[],n.count-=1,n;case"UPDATE_WINNER":return n.items.forEach(((t,a)=>{if(t.id===e.payload?.[0].id){const t=e.payload[0];n.items[a]=t}})),n;case"NEXT_PAGE":return(n.count>10||n.page<Math.ceil(n.count/10))&&(n.page+=1,n.items=[]),n;case"PREV_PAGE":return n.page>1&&(n.page-=1,n.items=[]),n;case"SORT_MODE":return e.sort&&(n.sort=e.sort),e.order&&(n.order=e.order),n.items=[],n;case"OFF_SORT_MODE":return n.sort="",n.order="",n.items=[],n;default:return n}}),{items:[],count:0,page:1,sort:"",order:"",fetchError:""}),L={startedEngine:[],animations:[],addStartedEngine:t=>{L.startedEngine.push(t)},removeStoppedEngine:t=>{L.startedEngine=L.startedEngine.filter((e=>e!==t))},isEngineStarts:t=>L.startedEngine.includes(t),addAnimation:t=>{L.animations.push(t)},stopAnimation:t=>{L.animations.forEach((e=>{e.id===t&&e.cancel()}))},removeAnimation:t=>{L.animations=L.animations.filter((e=>e.id!==t))},resetAllAnimation:()=>{L.animations.forEach((t=>t.cancel())),L.animations=[],L.startedEngine=[]}},M=L,N=async t=>{try{const e=await fetch(`${T.winners}/${t}`);return await e.json()}catch(t){throw new Error("Something went wrong")}},k=async()=>{try{const{page:t,sort:e,order:n}=A.getState(),{data:a,count:r}=await(async(t,e,n)=>{try{const a=await fetch(`${T.winners}?_page=${t}&_limit=10&_sort=${e}&_order=${n}`),r=await a.json(),s=a.headers.get("X-Total-Count");return{data:r,count:Number(s)}}catch(t){throw new Error("Something went wrong. Most likely, you need to run the server locally from this repo: https://github.com/mikhama/async-race-api")}})(t,e,n);A.dispatch({type:"FETCH",payload:a,count:r})}catch(t){A.dispatch({type:"FETCH_ERROR",error:t})}},$=async(t,e)=>{"garage"===t?("prev"===e?s.dispatch({type:"PREV_PAGE"}):s.dispatch({type:"NEXT_PAGE"}),await R(),M.resetAllAnimation()):("prev"===e?A.dispatch({type:"PREV_PAGE"}):A.dispatch({type:"NEXT_PAGE"}),await k())};var O=n(756),D={};D.styleTagTransform=f(),D.setAttributes=m(),D.insert=p().bind(null,"head"),D.domAPI=d(),D.insertStyleElement=_(),o()(O.Z,D),O.Z&&O.Z.locals&&O.Z.locals;var I=n(736),Z={};Z.styleTagTransform=f(),Z.setAttributes=m(),Z.insert=p().bind(null,"head"),Z.domAPI=d(),Z.insertStyleElement=_(),o()(I.Z,Z),I.Z&&I.Z.locals&&I.Z.locals;const P=t=>{const e=document.createElement("section");e.classList.add("section",t,"hidden");const n=document.createElement("h1");n.classList.add("section__title");const a=t.charAt(0).toUpperCase()+t.slice(1),r=(t=>{const e=document.createElement("div");e.classList.add("pagination");const n=document.createElement("p");n.classList.add("pagination__title");const a=document.createElement("div");a.classList.add("pagination__buttons");const r=y({text:"<",customClass:"button--main",onClick:()=>$(t,"prev")}),i=y({text:">",customClass:"button--main",onClick:()=>$(t,"next")});return a.append(r,i),s.subscribe((e=>{if("garage"===t){const{page:t,count:a,isWalkBlocking:s}=e;n.textContent=`Page #${t}`,r.disabled=1===t||s,i.disabled=a<=7||t===Math.ceil(a/7)||s}})),A.subscribe((e=>{if("winners"===t){const{page:t,count:a}=e;n.textContent=`Page #${t}`,r.disabled=1===t,i.disabled=a<=10||t===Math.ceil(a/10)}})),e.append(n,a),e})(t);return s.subscribe((e=>{"garage"===t&&(n.textContent=`${a} (${e.count})`)})),A.subscribe((e=>{"winners"===t&&(n.textContent=`${a} (${e.count})`)})),e.append(n,r),e},F=async t=>{t.preventDefault();const e=t.target,n=new FormData(e),a=n.get("name")?.toString().trim(),r=n.get("color")?.toString();if(a&&r)try{const t=await S({name:a,color:r});s.dispatch({type:"ADD_ITEMS",payload:[t]}),e.reset()}catch(t){console.log(t)}},U={brands:["Tesla","Chevrolet","Toyota","Volkswagen","Nissan","Honda","Audi","Jaguar","Land Rover","Volvo","Lexus","Mitsubishi","Peugeot","Skoda","Fiat","Geely","Great Wall","Chery","Hyundai","Kia","Genesis","SsangYong","Renault"],models:["McQueen","3008","Octavia","Kodiaq","Lancer","Outlander","Defender","Discovery","XE","Forester","Impreza","Legacy","Model S","Model X","Pathfinder","Accord","Civic","Tiguan","Golf","A4","A8","S-Class","GLE","i8","X5","M3","Tahoe","Camaro","Malibu","Focus","Mustang","F-150","RAV4","Camry","Prius","Duster","G80","Sportage","Optima","Rio","Sonata","Santa Fe","Tiggo 7","Haval F7","Emgrand X7"]},W={actions:{},resets:{}},H=async(t,e)=>{const{id:n,time:a}=await Promise.race(t);if(null===a){const a=e.findIndex((t=>t===n)),r=t.filter(((t,e)=>e!==a)),s=e.filter(((t,e)=>e!==a));return H(r,s)}return{id:n,time:a}},V=async()=>{s.dispatch({type:"ON_RACE_MODE"}),s.dispatch({type:"BLOCK_PAGI_AND_NAV"});const{items:t}=s.getState(),{actions:e}=W,n=t.map((t=>e[t.id]?.())),a=t.map((t=>t.id)),{id:r,time:i}=await H(n,a);s.dispatch({type:"ADD_CURRENT_WINNER",winnerId:r}),await(async t=>{try{const e=await N(t.id);if(e.id){const{id:n,wins:a,time:r}=e,s={id:n,wins:a+1,time:r<=t.time?r:t.time};await(async t=>{try{const e=await fetch(`${T.winners}/${t.id}`,{method:"PUT",body:JSON.stringify({wins:t.wins,time:t.time}),headers:{"Content-Type":"application/json"}});return await e.json()}catch(t){throw new Error("Something went wrong")}})(s),A.dispatch({type:"UPDATE_WINNER",payload:[s]})}else{const e=await(async t=>{try{const e=await fetch(T.winners,{method:"POST",body:JSON.stringify(t),headers:{"Content-Type":"application/json"}});return await e.json()}catch(t){throw new Error("Something went wrong")}})({...t,wins:1});A.dispatch({type:"ADD_WINNER",payload:[e]})}}catch(t){console.log(t)}})({id:r,time:i/1e3})},j=async t=>{t.preventDefault();const e=t.target,n=new FormData(e),a=Number(e.dataset.carId),r=n.get("name")?.toString().trim(),i=n.get("color")?.toString();if(window.confirm("are you sure you want to update this car")&&r&&i)try{const t=await(async t=>{try{const e=await fetch(`${T.garage}/${t.id}`,{method:"PUT",body:JSON.stringify({name:t.name,color:t.color}),headers:{"Content-Type":"application/json"}});return await e.json()}catch(t){throw new Error("Something went wrong")}})({id:a,name:r,color:i});s.dispatch({type:"UPDATE_ITEM",payload:[t]})}catch(t){console.log(t)}};var X=n(6),G={};G.styleTagTransform=f(),G.setAttributes=m(),G.insert=p().bind(null,"head"),G.domAPI=d(),G.insertStyleElement=_(),o()(X.Z,G),X.Z&&X.Z.locals&&X.Z.locals;const z=({id:t,onSubmit:e})=>{const n=document.createElement("form");n.id=`form-${t}`,n.classList.add("form"),n.addEventListener("submit",(t=>e(t)));const a=document.createElement("input");a.id=`form-${t}-name`,a.name="name",a.classList.add("form__input","form__input--name"),a.required=!0;const r=document.createElement("input");r.id=`form-${t}-color`,r.name="color",r.type="color",r.defaultValue="#e2e8f0",r.classList.add("form__input","form__input--color");const i=y({text:t,customClass:"button--minor"});return i.type="submit",i.id=`form-${t}-button`,s.subscribe((e=>{"create"===t&&(a.disabled=e.isUpdate,r.disabled=e.isUpdate,i.disabled=e.isUpdate),"update"===t&&(a.disabled=!e.isUpdate,r.disabled=!e.isUpdate,i.disabled=!e.isUpdate),"update"===t&&e.selectedCar?(n.dataset.carId=`${e.selectedCar.id}`,a.value=e.selectedCar.name,r.value=e.selectedCar.color):"update"!==t||e.selectedCar||(n.removeAttribute("data-car-id"),a.value="",r.value="#e2e8f0")})),n.append(a,r,i),n},B=()=>{const t=document.createElement("div");t.classList.add("garage__controls");const e=z({id:"create",onSubmit:F}),n=z({id:"update",onSubmit:j}),a=document.createElement("div");a.classList.add("garage__buttons");const r=y({text:"race",customClass:"button--main",disabled:!1,onClick:V}),i=y({text:"reset",customClass:"button--main",disabled:!0,onClick:t=>(async t=>{const{items:e}=s.getState(),{resets:n}=W;t.target.disabled=!0;const a=e.map((t=>n[t.id]?.()));await Promise.all(a),s.dispatch({type:"OFF_RACE_MODE"}),s.dispatch({type:"REMOVE_CURRENT_WINNER"})})(t)}),o=y({text:"generate cars",customClass:"button--minor",onClick:t=>(async t=>{const e=t.target;e.disabled=!0;const n=function(t){const e=()=>{const{brands:t,models:e}=U;return`${t[Math.floor(Math.random()*t.length)]} ${e[Math.floor(Math.random()*e.length)]}`};return Array.from({length:100},(()=>({name:e(),color:Array.from({length:6}).reduce((t=>t+"0123456789ABCDEF"[Math.floor(16*Math.random())]),"#")})))}();try{const t=await Promise.all(n.map((async t=>await S(t))));s.dispatch({type:"ADD_ITEMS",payload:t}),e.disabled=!1}catch(t){console.log(t)}})(t)});return a.append(r,i,o),s.subscribe((t=>{r.disabled=t.isRace,i.disabled=!t.isRace})),t.append(e,n,a),t},J=async(t,e,n,a,r)=>{try{a.disabled=!0,s.dispatch({type:"ON_RACE_MODE"});const{velocity:i,distance:o}=await(async t=>{try{const e=await fetch(`${T.engine}/?id=${t}&status=started`,{method:"PATCH"});return await e.json()}catch(t){throw new Error("Something went wrong")}})(t);M.addStartedEngine(t);const c=Math.round(o/i),d=function(t,e){const n=t.getBoundingClientRect().left;return e.getBoundingClientRect().right-n}(e,n),l=function(t,e,n){const a=t.animate([{transform:"translateX(0)"},{transform:`translateX(${e}px)`}],{duration:n,fill:"forwards"});return a.id=`animate-${t.id}`,a}(e,d,c);M.addAnimation(l),r.disabled=!1;const{success:p}=await(async(t,e,n)=>{try{const a=await(async t=>{try{const e=await fetch(`${T.engine}/?id=${t}&status=drive`,{method:"PATCH"});return await e.json()}catch(t){throw new Error("Something went wrong")}})(t);return await n.finished&&(e.classList.add("car__icon--finished"),e.classList.remove("car__icon--broken")),a}catch(a){return console.log(`Car #${t} is broken`),n.pause(),M.isEngineStarts(t)&&e.classList.add("car__icon--broken"),{success:!1}}})(t,e,l);return p?{id:t,time:c}:{id:t,time:null}}catch{return{id:t,time:null}}},Y=t=>`\n    <svg xmlns="http://www.w3.org/2000/svg" viewBox="37.791 -4.07 470.349 155.232">\n      <path fill=${t} d="M 425.546 80.716 C 398.507 80.716 381.607 109.986 395.127 133.403 C 408.647 156.82 442.446 156.82 455.965 133.403 C 459.048 128.063 460.671 122.006 460.671 115.841 C 460.646 96.452 444.935 80.74 425.546 80.716 Z M 425.546 143.589 C 404.195 143.589 390.851 120.475 401.526 101.985 C 412.202 83.494 438.891 83.494 449.566 101.985 C 452.001 106.201 453.282 110.983 453.282 115.852 C 453.289 131.174 440.869 143.6 425.546 143.6 L 425.546 143.589 Z M 434.422 115.852 C 434.423 122.684 427.027 126.956 421.109 123.54 C 415.191 120.124 415.19 111.583 421.107 108.166 C 422.457 107.387 423.988 106.977 425.546 106.977 C 430.448 106.977 434.422 110.95 434.422 115.852 Z M 168.884 115.852 C 168.883 88.812 139.612 71.914 116.196 85.434 C 92.78 98.954 92.781 132.753 116.198 146.272 C 121.537 149.355 127.593 150.978 133.758 150.978 C 153.148 150.953 168.86 135.241 168.884 115.852 Z M 133.758 143.589 C 112.407 143.588 99.063 120.474 109.74 101.984 C 120.416 83.493 147.105 83.495 157.78 101.986 C 160.214 106.202 161.495 110.984 161.495 115.852 C 161.502 131.175 149.082 143.6 133.758 143.6 L 133.758 143.589 Z M 479.21 121.766 C 484.102 80.488 442.475 49.393 404.281 65.795 C 384.304 74.375 371.42 94.099 371.593 115.841 C 371.585 124.023 373.448 132.099 377.04 139.451 L 182.264 139.451 C 200.474 102.094 171.416 59.034 129.959 61.942 C 98.369 64.158 75.462 92.962 80.415 124.24 C 54.798 113.477 38.256 95.87 38.256 68.023 C 38.256 39.177 125.126 -1.395 180.378 -3.304 L 180.378 30.79 C 180.378 44.503 191.495 55.62 205.208 55.62 L 252.725 55.62 C 264.843 55.601 275.17 46.82 277.134 34.862 C 277.134 34.862 275.514 13.194 270.321 9.344 L 273.728 6.804 L 298.202 34.884 L 392.306 34.884 C 456.3 34.862 508.256 58.304 508.256 87.15 C 508.256 100.464 497.283 112.546 479.21 121.766 Z M 142.634 115.841 C 142.634 122.673 135.238 126.944 129.32 123.527 C 123.403 120.111 123.403 111.57 129.32 108.154 C 130.67 107.375 132.2 106.965 133.758 106.965 C 138.665 106.965 142.64 110.945 142.634 115.852 L 142.634 115.841 Z"/>\n    </svg>\n  `,K=({id:t,name:e,color:n})=>{const a=document.createElement("div");a.classList.add("car__road");const r=document.createElement("div");r.classList.add("car__road__buttons");const i=y({text:"D",customClass:"button--drive",disabled:!1}),o=y({text:"R",customClass:"button--stop",disabled:!0});r.append(i,o);const c=document.createElement("div");c.classList.add("car__icon"),c.id=`car-icon-${t}`,c.innerHTML=Y(n);const d=document.createElement("div");d.classList.add("car__road__finish"),d.textContent="FINISH";const l=document.createElement("div");l.classList.add("car__road__message"),l.textContent=`winner: ${e} #${t}`;const p=()=>J(t,c,d,i,o),u=()=>(async(t,e,n,a)=>{try{a.disabled=!0,await(async t=>{try{const e=await fetch(`${T.engine}/?id=${t}&status=stopped`,{method:"PATCH"});return await e.json()}catch(t){throw new Error("Something went wrong")}})(t),M.removeStoppedEngine(t),M.stopAnimation(`animate-${e.id}`),M.removeAnimation(`animate-${e.id}`),e.classList.remove("car__icon--broken","car__icon--finished"),n.disabled=!1,0===M.startedEngine.length&&(s.dispatch({type:"OFF_RACE_MODE"}),s.dispatch({type:"REMOVE_CURRENT_WINNER"}))}catch(t){console.log(t)}})(t,c,i,o);return i.addEventListener("click",p),o.addEventListener("click",u),W.actions[t]=p,W.resets[t]=u,s.subscribe((e=>{const a=e.items.find((e=>e.id===t));a&&a.color!==n&&(c.innerHTML=Y(a.color)),e.currentRaceWinner===t?(l.classList.add("display"),c.classList.remove("car__icon--finished"),c.classList.add("car__icon--winner")):(l.classList.remove("display"),c.classList.remove("car__icon--winner"))})),a.append(r,c,d,l),a},q=t=>{const e=document.createElement("div");e.classList.add("car__header");const n=y({text:"select",customClass:"button--minor",onClick:e=>((t,e)=>{const n=t.target,a=Number(n.dataset.carId),{selectedCar:r}=s.getState();a===r?.id?s.dispatch({type:"RESET_UPDATE_CAR"}):s.dispatch({type:"SELECT_CAR",payload:[e]})})(e,t)});n.dataset.carId=`${t.id}`;const a=y({text:"delete",customClass:"button--minor",onClick:()=>(async t=>{if(window.confirm(`are you sure you want to remove "${t.name}"?`))try{await(async t=>{try{await fetch(`${T.garage}/${t}`,{method:"DELETE"})}catch(t){throw new Error("Something went wrong")}})(t.id),await R(),s.dispatch({type:"RESET_UPDATE_CAR"}),M.removeStoppedEngine(t.id),M.stopAnimation(`animate-car-icon-${t.id}`),M.removeAnimation(`animate-car-icon-${t.id}`),0===M.startedEngine.length&&s.dispatch({type:"OFF_RACE_MODE"}),(await N(t.id)).id&&(await(async t=>{try{await fetch(`${T.winners}/${t}`,{method:"DELETE"})}catch(t){throw new Error("Something went wrong")}})(t.id),A.dispatch({type:"REMOVE_WINNER",winnerId:t.id}),await k())}catch(t){console.log(t)}})(t)}),r=document.createElement("p");r.classList.add("car__title");const i=document.createElement("span");i.textContent=t.name;const o=document.createElement("span");return o.textContent=`#${t.id}`,r.append(i,o),s.subscribe((e=>{const a=e.items.find((e=>e.id===t.id));a&&a.id===t.id&&a.name!==t.name&&(i.textContent=a.name),e.selectedCar?.id===t.id?n.classList.add("button--selected"):n.classList.remove("button--selected")})),e.append(n,a,r),e};var Q=n(889),tt={};tt.styleTagTransform=f(),tt.setAttributes=m(),tt.insert=p().bind(null,"head"),tt.domAPI=d(),tt.insertStyleElement=_(),o()(Q.Z,tt),Q.Z&&Q.Z.locals&&Q.Z.locals;const et=()=>{const t=document.createElement("div");return t.classList.add("garage__items"),s.subscribe((e=>{const n=[];t.childNodes.forEach((t=>{t instanceof HTMLElement&&n.push(Number(t.dataset.carId))})),e.items.forEach((e=>{n.includes(e.id)||t.append((t=>{const e=document.createElement("div");e.classList.add("car"),e.dataset.carId=`${t.id}`;const n=q(t),a=K(t);return s.subscribe((n=>{n.items.find((e=>e.id===t.id))||e.remove()})),e.append(n,a),e})(e))}))})),t};var nt=n(274),at={};at.styleTagTransform=f(),at.setAttributes=m(),at.insert=p().bind(null,"head"),at.domAPI=d(),at.insertStyleElement=_(),o()(nt.Z,at),nt.Z&&nt.Z.locals&&nt.Z.locals;const rt=async(t,e)=>{const n=t.target,a=n.dataset.sortField,{sort:r,order:s}=A.getState();switch(r===a||A.dispatch({type:"SORT_MODE",sort:a,order:""}),s){case"":n?.classList.add("sort--asc"),A.dispatch({type:"SORT_MODE",order:"ASC"});break;case"ASC":n?.classList.remove("sort--asc"),n?.classList.add("sort--desc"),A.dispatch({type:"SORT_MODE",order:"DESC"});break;case"DESC":n?.classList.remove("sort--desc"),A.dispatch({type:"OFF_SORT_MODE"})}await k(),e?.classList.remove("sort--desc"),e?.classList.remove("sort--asc")},st=async()=>{const t=document.createElement("table");t.classList.add("winners__table");const e=document.createElement("thead"),n=document.createElement("tr");n.classList.add("winners__table__row");const a=document.createElement("th");a.classList.add("winners__table__number"),a.textContent="Number";const r=document.createElement("th");r.classList.add("winners__table__car"),r.textContent="Car";const i=document.createElement("th");i.classList.add("winners__table__name"),i.textContent="Name";const o=document.createElement("th");o.dataset.sortField="wins",o.classList.add("winners__table__wins"),o.textContent="Wins";const c=document.createElement("th");c.dataset.sortField="time",c.classList.add("winners__table__time"),c.textContent="Best time (sec.)",o.addEventListener("click",(t=>rt(t,c))),c.addEventListener("click",(t=>rt(t,o))),n.append(a,r,i,o,c),e.append(n);const d=document.createElement("tbody");return A.subscribe((async t=>{const e=[];d.childNodes.forEach((t=>{t instanceof HTMLTableRowElement&&e.push(Number(t.dataset.winnerId))})),(await Promise.all(t.items.map((async(t,e)=>await(async(t,e)=>{const{page:n}=A.getState(),a=await(async t=>{try{const e=await fetch(`${T.garage}/${t}`);return await e.json()}catch(t){throw new Error("Something went wrong")}})(t.id),r=document.createElement("tr");r.classList.add("winners__table__row"),r.dataset.winnerId=`${t.id}`;const i=document.createElement("td");i.textContent=`${e+1+10*(n-1)}`;const o=document.createElement("td"),c=document.createElement("div");c.innerHTML=Y(a.color),o.append(c);const d=document.createElement("td");d.classList.add("winners__table__row--name");const l=document.createElement("span");l.textContent=a.name;const p=document.createElement("span");p.textContent=`#${a.id}`,d.append(l,p);const u=document.createElement("td");u.textContent=`${t.wins}`;const m=document.createElement("td");return m.textContent=`${t.time.toFixed(2)}`,A.subscribe((e=>{const n=e.items.find((e=>e.id===t.id));n||r.remove(),n&&n.wins!==t.wins&&(u.textContent=`${n.wins}`),n&&n.time!==t.time&&(m.textContent=`${n.time.toFixed(2)}`)})),s.subscribe((t=>{const e=t.items.find((t=>t.id===a.id));e&&e.color!==a.color&&(c.innerHTML=Y(e.color)),e&&e.name!==a.name&&(l.textContent=e.name,p.textContent=`#${a.id}`)})),r.append(i,o,d,u,m),r})(t,e))))).forEach((t=>{e.includes(Number(t.dataset.winnerId))||d.append(t)}))})),t.append(e,d),t};var it=n(997),ot={};ot.styleTagTransform=f(),ot.setAttributes=m(),ot.insert=p().bind(null,"head"),ot.domAPI=d(),ot.insertStyleElement=_(),o()(it.Z,ot),it.Z&&it.Z.locals&&it.Z.locals;const ct=async()=>{const t=document.createElement("main"),n=await(async()=>{await R();const{fetchError:t}=s.getState(),e=P("garage");if(t)e.textContent=t;else{const t=B(),n=et();e.append(t,n)}return e})(),a=await(async()=>{await k();const{fetchError:t}=A.getState(),e=P("winners");if(t)e.textContent=t;else{const t=await st();e.append(t)}return e})();return e.subscribe((t=>{"winners"===t.currentView?(n.classList.add("hidden"),a.classList.remove("hidden")):(n.classList.remove("hidden"),a.classList.add("hidden"))})),t.append(n,a),t};var dt=n(99),lt={};lt.styleTagTransform=f(),lt.setAttributes=m(),lt.insert=p().bind(null,"head"),lt.domAPI=d(),lt.insertStyleElement=_(),o()(dt.Z,lt),dt.Z&&dt.Z.locals&&dt.Z.locals,(async()=>{const t=(()=>{const t=document.createElement("header");t.classList.add("header");const n=y({text:"to garage",customClass:"button--main",onClick:()=>a("garage")}),r=y({text:"to winners",customClass:"button--main",onClick:()=>a("winners")});return s.subscribe((t=>{r.disabled=t.isWalkBlocking})),e.subscribe((t=>{n.disabled="garage"===t.currentView,r.disabled="winners"===t.currentView})),t.append(n,r),t})(),n=await ct();document.body.append(t,n)})()})()})();